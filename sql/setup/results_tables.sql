-- ======
-- Description: 
-- 	1. Drops if exists experiments, features, predictions
-- 	2. Creates experiments, features, and prediction tables
-- Last Updated: Aug 29, 2019
-- ======

drop table if exists results.experiments cascade;
drop table if exists results.features cascade;
drop table if exists results.predictions cascade;
drop sequence if exists param_config_seq cascade;

create sequence param_config_seq;

create table results.features(
  feature_set serial primary key,
  loc_app_details boolean,
  dowx boolean,
  dowy boolean,
  domx boolean,
  domy boolean,
  doyx boolean,
  doyy boolean,
  date_linear boolean,
  time_seen_flag boolean,
  time_expected_flag boolean,
  alert_origin_mobile boolean,
  alert_origin_web boolean,
  alert_origin_phone boolean,
  gender_female boolean,
  gender_male boolean,
  gender_unknown boolean,
  gender_nonbinary boolean,
  group_referral_flag boolean,
  member_of_public_flag boolean,
  appearance_details_entry_flag boolean,
  location_details_entry_flag boolean,
  avg_temperature boolean,
  max_temperature boolean,
  min_temperature boolean,
  avg_windspeed boolean,
  max_windgust boolean,
  max_precipprobability boolean,
  min_precipprobability boolean,
  snowaccumulation_flag boolean,
  appearance_wordcount boolean,
  location_wordcount boolean,
  concerns_wordcount boolean,
  la_avg_response_time_7d boolean,
	la_avg_response_time_28d boolean,
	alerts_last_7d boolean,
	alerts_last_28d boolean,
	person_found_last_7d boolean,
	person_found_last_28d boolean,
	referrals_last_7d boolean,
	referrals_last_28d boolean,
	person_found_rate_last_7d boolean,
	person_found_rate_last_28d boolean,
  "0_x" boolean,
  "1_x" boolean,
  "2_x" boolean,
  "3_x" boolean,
  "4_x" boolean,
  "5_x" boolean,
  "6_x" boolean,
  "7_x" boolean,
  "8_x" boolean,
  "9_x" boolean,
  "0_y" boolean,
  "1_y" boolean,
  "2_y" boolean,
  "3_y" boolean,
  "4_y" boolean,
  "5_y" boolean,
  "6_y" boolean,
  "7_y" boolean,
  "8_y" boolean,
  "9_y" boolean
);

alter table results.features
add column alerts_within_50m_7d boolean default false,
add column alerts_within_50m_7d_web_origin boolean default false,
add column alerts_within_50m_7d_phone_origin boolean default false,
add column alerts_within_50m_7d_mobile_app_origin boolean default false,
add column alerts_within_50m_28d boolean default false,
add column alerts_within_50m_28d_web_origin boolean default false,
add column alerts_within_50m_28d_phone_origin boolean default false,
add column alerts_within_50m_28d_mobile_app_origin boolean default false,
add column alerts_within_50m_60d boolean default false,
add column alerts_within_50m_60d_web_origin boolean default false,
add column alerts_within_50m_60d_phone_origin boolean default false,
add column alerts_within_50m_60d_mobile_app_origin boolean default false,
add column alerts_within_50m_6mo boolean default false,
add column alerts_within_50m_6mo_web_origin boolean default false,
add column alerts_within_50m_6mo_phone_origin boolean default false,
add column alerts_within_50m_6mo_mobile_app_origin boolean default false,
add column alerts_within_250m_7d boolean default false,
add column alerts_within_250m_7d_web_origin boolean default false,
add column alerts_within_250m_7d_phone_origin boolean default false,
add column alerts_within_250m_7d_mobile_app_origin boolean default false,
add column alerts_within_250m_28d boolean default false,
add column alerts_within_250m_28d_web_origin boolean default false,
add column alerts_within_250m_28d_phone_origin boolean default false,
add column alerts_within_250m_28d_mobile_app_origin boolean default false,
add column alerts_within_250m_60d boolean default false,
add column alerts_within_250m_60d_web_origin boolean default false,
add column alerts_within_250m_60d_phone_origin boolean default false,
add column alerts_within_250m_60d_mobile_app_origin boolean default false,
add column alerts_within_250m_6mo boolean default false,
add column alerts_within_250m_6mo_web_origin boolean default false,
add column alerts_within_250m_6mo_phone_origin boolean default false,
add column alerts_within_250m_6mo_mobile_app_origin boolean default false,
add column alerts_within_1000m_7d boolean default false,
add column alerts_within_1000m_7d_web_origin boolean default false,
add column alerts_within_1000m_7d_phone_origin boolean default false,
add column alerts_within_1000m_7d_mobile_app_origin boolean default false,
add column alerts_within_1000m_28d boolean default false,
add column alerts_within_1000m_28d_web_origin boolean default false,
add column alerts_within_1000m_28d_phone_origin boolean default false,
add column alerts_within_1000m_28d_mobile_app_origin boolean default false,
add column alerts_within_1000m_60d boolean default false,
add column alerts_within_1000m_60d_web_origin boolean default false,
add column alerts_within_1000m_60d_phone_origin boolean default false,
add column alerts_within_1000m_60d_mobile_app_origin boolean default false,
add column alerts_within_1000m_6mo boolean default false,
add column alerts_within_1000m_6mo_web_origin boolean default false,
add column alerts_within_1000m_6mo_phone_origin boolean default false,
add column alerts_within_1000m_6mo_mobile_app_origin boolean default false,
add column alerts_within_5000m_7d boolean default false,
add column alerts_within_5000m_7d_web_origin boolean default false,
add column alerts_within_5000m_7d_phone_origin boolean default false,
add column alerts_within_5000m_7d_mobile_app_origin boolean default false,
add column alerts_within_5000m_28d boolean default false,
add column alerts_within_5000m_28d_web_origin boolean default false,
add column alerts_within_5000m_28d_phone_origin boolean default false,
add column alerts_within_5000m_28d_mobile_app_origin boolean default false,
add column alerts_within_5000m_60d boolean default false,
add column alerts_within_5000m_60d_web_origin boolean default false,
add column alerts_within_5000m_60d_phone_origin boolean default false,
add column alerts_within_5000m_60d_mobile_app_origin boolean default false,
add column alerts_within_5000m_6mo boolean default false,
add column alerts_within_5000m_6mo_web_origin boolean default false,
add column alerts_within_5000m_6mo_phone_origin boolean default false,
add column alerts_within_5000m_6mo_mobile_app_origin boolean default false,
add column referrals_within_50m_7d boolean default false,
add column referrals_within_50m_7d_web_origin boolean default false,
add column referrals_within_50m_7d_phone_origin boolean default false,
add column referrals_within_50m_7d_mobile_app_origin boolean default false,
add column referrals_within_50m_28d boolean default false,
add column referrals_within_50m_28d_web_origin boolean default false,
add column referrals_within_50m_28d_phone_origin boolean default false,
add column referrals_within_50m_28d_mobile_app_origin boolean default false,
add column referrals_within_50m_60d boolean default false,
add column referrals_within_50m_60d_web_origin boolean default false,
add column referrals_within_50m_60d_phone_origin boolean default false,
add column referrals_within_50m_60d_mobile_app_origin boolean default false,
add column referrals_within_50m_6mo boolean default false,
add column referrals_within_50m_6mo_web_origin boolean default false,
add column referrals_within_50m_6mo_phone_origin boolean default false,
add column referrals_within_50m_6mo_mobile_app_origin boolean default false,
add column referrals_within_250m_7d boolean default false,
add column referrals_within_250m_7d_web_origin boolean default false,
add column referrals_within_250m_7d_phone_origin boolean default false,
add column referrals_within_250m_7d_mobile_app_origin boolean default false,
add column referrals_within_250m_28d boolean default false,
add column referrals_within_250m_28d_web_origin boolean default false,
add column referrals_within_250m_28d_phone_origin boolean default false,
add column referrals_within_250m_28d_mobile_app_origin boolean default false,
add column referrals_within_250m_60d boolean default false,
add column referrals_within_250m_60d_web_origin boolean default false,
add column referrals_within_250m_60d_phone_origin boolean default false,
add column referrals_within_250m_60d_mobile_app_origin boolean default false,
add column referrals_within_250m_6mo boolean default false,
add column referrals_within_250m_6mo_web_origin boolean default false,
add column referrals_within_250m_6mo_phone_origin boolean default false,
add column referrals_within_250m_6mo_mobile_app_origin boolean default false,
add column referrals_within_1000m_7d boolean default false,
add column referrals_within_1000m_7d_web_origin boolean default false,
add column referrals_within_1000m_7d_phone_origin boolean default false,
add column referrals_within_1000m_7d_mobile_app_origin boolean default false,
add column referrals_within_1000m_28d boolean default false,
add column referrals_within_1000m_28d_web_origin boolean default false,
add column referrals_within_1000m_28d_phone_origin boolean default false,
add column referrals_within_1000m_28d_mobile_app_origin boolean default false,
add column referrals_within_1000m_60d boolean default false,
add column referrals_within_1000m_60d_web_origin boolean default false,
add column referrals_within_1000m_60d_phone_origin boolean default false,
add column referrals_within_1000m_60d_mobile_app_origin boolean default false,
add column referrals_within_1000m_6mo boolean default false,
add column referrals_within_1000m_6mo_web_origin boolean default false,
add column referrals_within_1000m_6mo_phone_origin boolean default false,
add column referrals_within_1000m_6mo_mobile_app_origin boolean default false,
add column referrals_within_5000m_7d boolean default false,
add column referrals_within_5000m_7d_web_origin boolean default false,
add column referrals_within_5000m_7d_phone_origin boolean default false,
add column referrals_within_5000m_7d_mobile_app_origin boolean default false,
add column referrals_within_5000m_28d boolean default false,
add column referrals_within_5000m_28d_web_origin boolean default false,
add column referrals_within_5000m_28d_phone_origin boolean default false,
add column referrals_within_5000m_28d_mobile_app_origin boolean default false,
add column referrals_within_5000m_60d boolean default false,
add column referrals_within_5000m_60d_web_origin boolean default false,
add column referrals_within_5000m_60d_phone_origin boolean default false,
add column referrals_within_5000m_60d_mobile_app_origin boolean default false,
add column referrals_within_5000m_6mo boolean default false,
add column referrals_within_5000m_6mo_web_origin boolean default false,
add column referrals_within_5000m_6mo_phone_origin boolean default false,
add column referrals_within_5000m_6mo_mobile_app_origin boolean default false,
add column persons_found_within_50m_7d boolean default false,
add column persons_found_within_50m_7d_web_origin boolean default false,
add column persons_found_within_50m_7d_phone_origin boolean default false,
add column persons_found_within_50m_7d_mobile_app_origin boolean default false,
add column persons_found_within_50m_28d boolean default false,
add column persons_found_within_50m_28d_web_origin boolean default false,
add column persons_found_within_50m_28d_phone_origin boolean default false,
add column persons_found_within_50m_28d_mobile_app_origin boolean default false,
add column persons_found_within_50m_60d boolean default false,
add column persons_found_within_50m_60d_web_origin boolean default false,
add column persons_found_within_50m_60d_phone_origin boolean default false,
add column persons_found_within_50m_60d_mobile_app_origin boolean default false,
add column persons_found_within_50m_6mo boolean default false,
add column persons_found_within_50m_6mo_web_origin boolean default false,
add column persons_found_within_50m_6mo_phone_origin boolean default false,
add column persons_found_within_50m_6mo_mobile_app_origin boolean default false,
add column persons_found_within_250m_7d boolean default false,
add column persons_found_within_250m_7d_web_origin boolean default false,
add column persons_found_within_250m_7d_phone_origin boolean default false,
add column persons_found_within_250m_7d_mobile_app_origin boolean default false,
add column persons_found_within_250m_28d boolean default false,
add column persons_found_within_250m_28d_web_origin boolean default false,
add column persons_found_within_250m_28d_phone_origin boolean default false,
add column persons_found_within_250m_28d_mobile_app_origin boolean default false,
add column persons_found_within_250m_60d boolean default false,
add column persons_found_within_250m_60d_web_origin boolean default false,
add column persons_found_within_250m_60d_phone_origin boolean default false,
add column persons_found_within_250m_60d_mobile_app_origin boolean default false,
add column persons_found_within_250m_6mo boolean default false,
add column persons_found_within_250m_6mo_web_origin boolean default false,
add column persons_found_within_250m_6mo_phone_origin boolean default false,
add column persons_found_within_250m_6mo_mobile_app_origin boolean default false,
add column persons_found_within_1000m_7d boolean default false,
add column persons_found_within_1000m_7d_web_origin boolean default false,
add column persons_found_within_1000m_7d_phone_origin boolean default false,
add column persons_found_within_1000m_7d_mobile_app_origin boolean default false,
add column persons_found_within_1000m_28d boolean default false,
add column persons_found_within_1000m_28d_web_origin boolean default false,
add column persons_found_within_1000m_28d_phone_origin boolean default false,
add column persons_found_within_1000m_28d_mobile_app_origin boolean default false,
add column persons_found_within_1000m_60d boolean default false,
add column persons_found_within_1000m_60d_web_origin boolean default false,
add column persons_found_within_1000m_60d_phone_origin boolean default false,
add column persons_found_within_1000m_60d_mobile_app_origin boolean default false,
add column persons_found_within_1000m_6mo boolean default false,
add column persons_found_within_1000m_6mo_web_origin boolean default false,
add column persons_found_within_1000m_6mo_phone_origin boolean default false,
add column persons_found_within_1000m_6mo_mobile_app_origin boolean default false,
add column persons_found_within_5000m_7d boolean default false,
add column persons_found_within_5000m_7d_web_origin boolean default false,
add column persons_found_within_5000m_7d_phone_origin boolean default false,
add column persons_found_within_5000m_7d_mobile_app_origin boolean default false,
add column persons_found_within_5000m_28d boolean default false,
add column persons_found_within_5000m_28d_web_origin boolean default false,
add column persons_found_within_5000m_28d_phone_origin boolean default false,
add column persons_found_within_5000m_28d_mobile_app_origin boolean default false,
add column persons_found_within_5000m_60d boolean default false,
add column persons_found_within_5000m_60d_web_origin boolean default false,
add column persons_found_within_5000m_60d_phone_origin boolean default false,
add column persons_found_within_5000m_60d_mobile_app_origin boolean default false,
add column persons_found_within_5000m_6mo boolean default false,
add column persons_found_within_5000m_6mo_web_origin boolean default false,
add column persons_found_within_5000m_6mo_phone_origin boolean default false,
add column persons_found_within_5000m_6mo_mobile_app_origin boolean default false,
add column distance_to_nearest_hotspot boolean default false,
add column hotspot_within_50m boolean default false,
add column hotspot_within_100m boolean default false,
add column hotspot_within_250m boolean default false,
add column hotspot_within_500m boolean default false,
add column hotspot_within_1000m boolean default false,
add column hotspot_within_5000m boolean default false,
add column hotspot_within_10km boolean default false,
add column sleep boolean default false,
add column other_activity boolean default false,
add column important_word boolean default false,
add column mental_health boolean default false;


create table results.experiments(
  model serial primary key,
  experiment integer,
  fold integer,
  feature_set integer references results.features(feature_set),
  param_config integer,
  algorithm varchar,
  date_ran timestamp,
  train_X_fp varchar,
  train_y_fp varchar,
  test_X_fp varchar,
  test_y_fp varchar,
  num_nulls int,
  num_referrals int,
  precision_at_k jsonb,
  recall_at_k jsonb,
  feature_importance jsonb,
  std_feature_importance jsonb
);

create table results.predictions(
  as_of_date date,
  alert varchar,
  label int,
  score float,
  model integer references results.experiments(model),
  primary key (alert, model, as_of_date)
);
